{% set lib_version = "2.4.3" %}
{% set python_version = "3.2.0" %}
{% set python_sha256 = "e47fd1d0a27c550050e1d55b82db1b46f6494188daf5e7fdaafa0a958ef0a8c4" %}

package:
  name: pdal-split
  version: {{ lib_version }}

source:
  url: https://github.com/PDAL/PDAL/releases/download/{{ lib_version }}/PDAL-{{ lib_version }}-src.tar.bz2
  sha256: 3d2b00e87d177f6d01fee3dd3436cd9fc1f6d821fae40f36dccc07469d0d8226

build:
  number: 0
  skip: true  # [(win and vc<14) or (py<36) or (py<38 and linux)]

requirements:
  build:
    - {{ compiler('cxx') }}
    - {{ compiler('c') }}
    - cmake
    - make
    - pkg-config
  host:
    - libgdal
    - geotiff
    - libpq
    - libkml
    - eigen
    - nitro
    - curl
    - zlib
    - hdf5
    - tiledb
    - zstd
    - libxml2
    - draco
    - openssl
  run:
    - libgdal
    - geotiff
    - libpq
    - libkml
    - eigen
    - nitro
    - curl
    - zlib
    - hdf5
    - tiledb
    - zstd
    - libxml2
    - draco
    - openssl
    - pdal

  outputs:
    - name: libpdal
      version: {{ lib_version }}
      script: install_lib.sh  # [unix]
      script: install_lib.bat  # [win]

      build:
        run_exports:
          - {{ pin_compatible('libpdal', max_pin='x.x') }}

      requirements:
        run_constrained:   # [osx and x86_64]
          - __osx >={{ MACOSX_DEPLOYMENT_TARGET|default("10.9") }}  # [osx and x86_64]
        build:
          - {{ compiler('cxx') }}
          - {{ compiler('c') }}
          - cmake
          - make
          - pkg-config
        host:
          - libgdal
          - geotiff
          - libpq
          - libkml
          - eigen
          - nitro
          - curl
          - zlib
          - hdf5
          - tiledb
          - zstd
          - libxml2
          - draco
          - openssl
        run:
          - libgdal
          - geotiff
          - libpq
          - libkml
          - eigen
          - nitro
          - curl
          - zlib
          - hdf5
          - tiledb
          - zstd
          - libxml2
          - draco
          - openssl
      test:
        commands:
          - pdal --version
          - pdal --drivers --debug
      about:
        home: https://www.pdal.io
        license: BSD-3-Clause
        license_file: LICENSE.txt
        summary: Point Data Abstraction Library (PDAL)
        description: Point cloud data processing.
        doc_url: https://pdal.io
        dev_url: https://github.com/pdal/pdal

    - name: pdal
      version: {{ python_version }}
      source:
        fn: "python-pdal-{{ python_version }}.tar.gz"
        url: https://github.com/PDAL/python/archive/{{ python_version }}.tar.gz
        sha256: {{ python_sha256 }}

        skip: true  # [(win and vc<14) or (py<36) or (py<38 and linux)]


      requirements:
        run_constrained:   # [osx]
          - __osx >={{ MACOSX_DEPLOYMENT_TARGET|default("10.9") }}      # [osx]
        build:
          - {{ compiler('cxx') }}
          - make
          - python                                 # [build_platform != target_platform]
          - cross-python_{{ target_platform }}     # [build_platform != target_platform]
          - numpy                                  # [build_platform != target_platform]
          - pybind11                               # [build_platform != target_platform]
          - curl
          - cmake
          - libpdal

        host:
          - python
          - libpdal
          - numpy
          - pip
          - pybind11
          - scikit-build
        run:
          - {{ pin_compatible('numpy') }}
          - {{ pin_compatible('libpdal', max_pin='x.x') }}
          - python

      test:
        commands:
          - python -c "import pdal"




about:
  home: https://www.pdal.io
  license: BSD-3-Clause
  license_file: LICENSE.txt
  summary: Point Data Abstraction Library (PDAL)
  description: Point cloud data processing.
  doc_url: https://pdal.io
  dev_url: https://github.com/pdal/pdal

extra:
  recipe-maintainers:
    - chambbj
    - hobu
